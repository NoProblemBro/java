# zuul

## 1.在zuul中添加ip黑名单检测流程
通过加载PRE_TYPE的Filter,对所有请求进行拦截，将所有请求头转发给ip黑名单检测服务进行ip黑名单检测。ip黑名单检测服务检测到黑名单后，将黑名单返回给zuul，zuul随后拒绝访问。这个方案的好处就是可以将无效流量限制在网关之外，防止流量穿透内网。缺点是对ip黑名单检测服务要求较高，必须低延时高可用，否则一但出现阻塞，将出现雪崩现象。理论上http请求可以横向扩展，不考虑资金的情况下，能够保证高可用。如果不能保证ip黑名单检测服务高可用，触发了服务熔断，请求是否应该放过，还是因ip黑名单检测服务的熔断而熔断？不做任何其他实现的话，默认的就是因ip黑名单检测服务的熔断而熔断。

## 2.ip黑名单检测开关以及应用定制化ip黑名单
ip黑名单可以是全局的，也可以是为某个应用定制的。这里涉及到一个问题，全局的黑名单是否有必要？理论上，任何互联网应用都有这个需求。但是考虑到大多数小厂都有可能用不上这个功能，因此增加了一个开关。关于为某个应用定制黑名单，起初我想的是，在zuul中增加一个配置，就是忽略那些无需ip黑名单检测的服务。
可转念一想，这些需求如果都定制到zuul，那么届时zuul会越来越复杂，越来越臃肿。所以这个需求应该迁移到ip黑名单检测服务上，只需要在请求头增加源服务id即可。